---
title: 'Extension sample: custom validation'
metaTitle: 'Extension sample: custom validation'
metaDescription: 'How to use Prisma Client middleware to add custom validation for your queries.'
tocDepth: 3
---

<TopBlock>

Before you create Prisma Client extensions, you must enable the `clientExtensions` feature flag in the `generator` block of your `schema.prisma` file, as follows:

```prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}
```

<Admonition type="info">

The Preview feature is available from v4.7.0 and higher.

</Admonition>

The following example validates the input for the `create` and `update` methods on a `User` model using [Zod](https://github.com/colinhacks/zod):

```tsx
import { PrismaClient, type Prisma } from '@prisma/client'
import { z } from "zod";

// User object schema
export const UserSchema = z.object({
  // string and a valid email address
  email: z.string().email(),
  // password is between 7 and 30 characters long
  password: z.string().min(7).max(30),
  // first name is between 2 and 50 characters long
  firstName: z.string().min(2).max(50),
  // first name is between 2 and 50 characters long
  lastName: z.string().min(2).max(50),
}) satisfies z.Schema<Prisma.UserCreateInput>

const prisma = new PrismaClient()
  .$extends({
    /**
     * The `query` component allows you to hook into a query and modify query arguments
     */
    query: {
      user: {
        create({ args, query }) {
          /** validate the user input based on the schema */
          args.data = UserSchema.parse(args.data);
          return query(args)
        },
        update({ args, query }) {
          /** the partial() method marks all the properties in the schema as optional */
          args.data = UserSchema.partial().parse(args.data);
          return query(args)
        },
      }
    }
  })

// Example query
await prisma.user.create({
  data: {
    firstName: 'Alice',
    lastName: 'Jackson',
    password: 'randomnumbers',
    email: 'alice@prisma.io',
  }
})

// This query will fail because it the email input is invalid
await prisma.user.update({
  where: {
    id: 1
  },
  data: {
    email: 'user@prisma'
  }
})
```

The Node.js ecosystem offers a number of high-quality, easy-to-use validation libraries to choose from including: [joi](https://github.com/sideway/joi), [validator.js](https://github.com/validatorjs/validator.js), [Yup](https://github.com/jquense/yup), [Zod](https://github.com/colinhacks/zod) and [Superstruct](https://github.com/ianstormtaylor/superstruct).

The example is based on the following sample schema:

```prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Post {
  id        Int     @id @default(autoincrement())
  title     String
  content   String?
  published Boolean @default(false)

  user     User? @relation(fields: [authorId], references: [id])
  authorId Int?

  @@index([authorId], name: "authorId")
}

model User {
  id    Int     @id @default(autoincrement())
  name  String?
  email String  @unique

  posts Post[]
}
```

</TopBlock>

{/\*\*

## Going Further

- Learn how you can create and modify queries using [Prisma Client extensions](/concepts/components/prisma-client/client-extensions/query)
- Learn how you can organize your code better by moving the `signup` function into [a custom model](/concepts/components/prisma-client/custom-models).
  \*/}
